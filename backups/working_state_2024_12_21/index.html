<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tradepro Finder Toronto | Find Trusted Trade Workers Near You</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* Your existing styles */
        .hero-section {
            background: linear-gradient(rgba(44, 62, 80, 0.9), rgba(44, 62, 80, 0.9)), url('/static/images/hero-bg.jpg');
            background-size: cover;
            color: white;
            padding: 100px 0;
        }p
        
        /* New section styles */
        .feature-card, .service-card, .testimonial-card {
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            margin-bottom: 20px;
        }
        
        .feature-card:hover, .service-card:hover {
            transform: translateY(-5px);
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            background: #2c3e50;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            font-weight: bold;
        }
        
        .stars {
            color: #ffc107;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-tools me-2"></i>
                Tradepro Finder Toronto
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#features">Features</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#services">Services</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#testimonials">Testimonials</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="row">
                <div class="col-md-8 mx-auto text-center">
                    <h1 class="mb-4">Find Trusted Trade Workers in Toronto</h1>
                    <p class="lead mb-5">Connect with verified professionals for your home improvement and repair needs</p>
                    
                    <!-- Search Form -->
                    <div class="search-form">
                        <form id="searchForm" class="bg-white p-4 rounded shadow">
                            <div class="row g-3">
                                <div class="col-md-5">
                                    <select class="form-select" id="category" required>
                                        <option value="">Select Service Category</option>
                                    </select>
                                </div>
                                <div class="col-md-5">
                                    <select class="form-select" id="location" required>
                                        <option value="">Select Location</option>
                                    </select>
                                </div>
                                <div class="col-md-2">
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="fas fa-search me-2"></i>Search
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section id="features" class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">Why Choose Us</h2>
            <div class="row">
                <div class="col-md-4">
                    <div class="feature-card p-4 text-center">
                        <i class="fas fa-check-circle fa-3x mb-3 text-primary"></i>
                        <h3>Verified Professionals</h3>
                        <p>All trade workers are thoroughly vetted and verified.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card p-4 text-center">
                        <i class="fas fa-star fa-3x mb-3 text-primary"></i>
                        <h3>Trusted Reviews</h3>
                        <p>Read authentic reviews from real customers.</p>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="feature-card p-4 text-center">
                        <i class="fas fa-dollar-sign fa-3x mb-3 text-primary"></i>
                        <h3>Free Quotes</h3>
                        <p>Get multiple quotes with no obligation.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Services Section -->
    <section id="services" class="py-5 bg-light">
        <div class="container">
            <h2 class="text-center mb-5">Popular Services</h2>
            <div class="row">
                <div class="col-md-3">
                    <div class="service-card p-4 text-center">
                        <i class="fas fa-wrench fa-3x mb-3 text-primary"></i>
                        <h3>Plumbing</h3>
                        <p>Emergency repairs and installations</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="service-card p-4 text-center">
                        <i class="fas fa-bolt fa-3x mb-3 text-primary"></i>
                        <h3>Electrical</h3>
                        <p>Wiring and safety inspections</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="service-card p-4 text-center">
                        <i class="fas fa-paint-roller fa-3x mb-3 text-primary"></i>
                        <h3>Painting</h3>
                        <p>Interior and exterior painting</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="service-card p-4 text-center">
                        <i class="fas fa-hammer fa-3x mb-3 text-primary"></i>
                        <h3>Carpentry</h3>
                        <p>Custom woodwork and repairs</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Testimonials Section -->
    <section id="testimonials" class="py-5">
        <div class="container">
            <h2 class="text-center mb-5">What Our Users Say</h2>
            <div class="row">
                <div class="col-md-4">
                    <div class="testimonial-card p-4">
                        <div class="stars mb-3">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p>"Found a great plumber through this platform. Quick response and excellent work!"</p>
                        <div class="mt-3">
                            <strong>Sarah M.</strong> - Etobicoke
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="testimonial-card p-4">
                        <div class="stars mb-3">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p>"Very professional electrician. Fair price and great service!"</p>
                        <div class="mt-3">
                            <strong>John D.</strong> - North York
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="testimonial-card p-4">
                        <div class="stars mb-3">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                        </div>
                        <p>"Easy to use platform. Found a painter within hours!"</p>
                        <div class="mt-3">
                            <strong>Mike R.</strong> - Scarborough
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Results Section -->
    <section class="container results-container">
        <div id="loading" class="loading d-none">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
        </div>
        <div id="searchResults" class="row"></div>
        <div id="pagination" class="d-flex justify-content-center mt-4"></div>
    </section>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Load categories and locations on page load
        async function loadFormData() {
            try {
                console.log('Loading form data...');
                const [categoriesResponse, locationsResponse] = await Promise.all([
                    fetch('/api/categories'),
                    fetch('/api/locations')
                ]);

                if (!categoriesResponse.ok) {
                    throw new Error(`Categories API error: ${categoriesResponse.status}`);
                }
                if (!locationsResponse.ok) {
                    throw new Error(`Locations API error: ${locationsResponse.status}`);
                }

                const categories = await categoriesResponse.json();
                const locations = await locationsResponse.json();

                console.log('Categories:', categories);
                console.log('Locations:', locations);

                const categorySelect = document.getElementById('category');
                const locationSelect = document.getElementById('location');

                // Clear existing options
                categorySelect.innerHTML = '<option value="">Select Service Category</option>';
                locationSelect.innerHTML = '<option value="">Select Location</option>';

                // Add categories
                categories.forEach(category => {
                    const option = document.createElement('option');
                    option.value = category;
                    option.textContent = category;
                    categorySelect.appendChild(option);
                });

                // Add locations
                locations.forEach(location => {
                    const option = document.createElement('option');
                    option.value = location;
                    option.textContent = location;
                    locationSelect.appendChild(option);
                });

                console.log('Form data loaded successfully');
            } catch (error) {
                console.error('Error loading form data:', error);
                showError('Error loading form data. Please refresh the page. Error: ' + error.message);
            }
        }

        // Call loadFormData when the page loads
        window.onload = loadFormData;

        // Search functionality
        async function searchBusinesses(pageToken = null) {
            const category = document.getElementById('category').value;
            const location = document.getElementById('location').value;
            
            if (!category || !location) {
                showError('Please select both category and location');
                return;
            }

            document.getElementById('loading').classList.remove('d-none');
            document.getElementById('searchResults').innerHTML = '';
            document.getElementById('pagination').innerHTML = '';

            try {
                const response = await fetch(`/api/search?category=${encodeURIComponent(category)}&location=${encodeURIComponent(location)}${pageToken ? `&pageToken=${pageToken}` : ''}`);
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error);
                }

                displayResults(data);
            } catch (error) {
                console.error('Error searching businesses:', error);
                showError('An error occurred while searching. Please try again.');
            } finally {
                document.getElementById('loading').classList.add('d-none');
            }
        }

        function displayResults(data) {
            const resultsDiv = document.getElementById('searchResults');
            const businesses = data.places;

            if (!businesses || businesses.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="col-12 text-center">
                        <p class="alert alert-info">No results found for your search. Please try different criteria.</p>
                    </div>
                `;
                return;
            }

            businesses.forEach(business => {
                const card = document.createElement('div');
                card.className = 'col-md-6 col-lg-4 mb-4';
                card.innerHTML = `
                    <div class="card h-100">
                        <div class="card-body">
                            <h5 class="card-title">${business.name}</h5>
                            <p class="card-text">
                                <i class="fas fa-map-marker-alt text-primary me-2"></i>${business.address}<br>
                                ${business.rating ? `
                                    <span class="text-warning">
                                        ${Array(Math.round(business.rating)).fill('★').join('')}
                                        ${Array(5 - Math.round(business.rating)).fill('☆').join('')}
                                    </span>
                                    <small class="text-muted">(${business.user_ratings_total} reviews)</small>
                                ` : ''}
                                ${business.phone ? `<br><i class="fas fa-phone text-primary me-2"></i>${business.phone}` : ''}
                                ${business.website ? `<br><i class="fas fa-globe text-primary me-2"></i><a href="${business.website}" target="_blank">Website</a>` : ''}
                            </p>
                            <div class="d-flex justify-content-between align-items-center">
                                <button onclick="showInquiryForm('${business.name}')" class="btn btn-primary">
                                    <i class="fas fa-envelope me-2"></i>Contact
                                </button>
                                <a href="#" class="btn btn-outline-secondary">
                                    <i class="fas fa-info-circle me-2"></i>Details
                                </a>
                            </div>
                        </div>
                    </div>
                `;
                resultsDiv.appendChild(card);
            });

            if (data.next_page_token) {
                const paginationDiv = document.getElementById('pagination');
                const loadMoreBtn = document.createElement('button');
                loadMoreBtn.className = 'btn btn-outline-primary';
                loadMoreBtn.innerHTML = '<i class="fas fa-sync-alt me-2"></i>Load More';
                loadMoreBtn.onclick = () => searchBusinesses(data.next_page_token);
                paginationDiv.appendChild(loadMoreBtn);
            }
        }

        function showError(message) {
            const alert = document.createElement('div');
            alert.className = 'alert alert-danger alert-dismissible fade show';
            alert.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            document.querySelector('.results-container').prepend(alert);
        }

        // Form submission
        document.getElementById('searchForm').onsubmit = function(e) {
            e.preventDefault();
            searchBusinesses();
        };
    </script>
</body>
</html>